name: "StopChat-Shell"
base_url: "http://localhost:8000"
openapi_url: "/openapi.json"

# State management replicates the session persistence of the original client
state:
  storage: ".stopchat-state.json"
  auto_inject:
    - "user_id"
    - "session_id"
    - "monster"
    - "language"
  defaults:
    monster: "betty"
    language: "en"
    origin: "dev_terminal"
    user_id: "3a05e90c-eaa8-480a-8d45-a445cf6abc6f"
commands:
  # Replicates /init [user_id] [monster] [language]
  /init:
    operationId: "initialize_chat_api_v1_chat_init_post"
    description: "Initialize a new session"
    # mapping:
    #   user_id: "$1"      # Positional: /init <user_id>
    #   monster: "$2"      # Positional: /init <user_id> <monster>
    #   language: "$3"
    after_call:
      save_to_state:
        # Extracts session_id from the JSON response to persist it
        session_id: "json:session_id"
        user_id: "json:user_id"
    formatting:
      title: "ðŸ“– Message"
      blocks:
        - fields:
          - path: "messages[0].content"
            label: "Response"
            format: "markdown"
        - layout: "table"
          fields:
            - path: "dropdown_options"
              label: "Dropdown"
              format: "markdown"
  # Replicates /send <message>
  /send:
    operationId: "handle_message_api_v1_chat_post"
    description: "Send a chat message"
    mapping:
      message: "$1"
      user_id: "$STATE.user_id"
      session_id: "$STATE.session_id"
      monster: "$STATE.monster"
      language: "$STATE.language"
    after_call:
      save_to_state:
        session_id: "json:session_id"
    formatting:
      title: "ðŸ“– Message"
      blocks:
        - fields:
          - path: "messages[0].content"
            label: "Response"
            format: "markdown"
        - layout: "table"
          fields:
            - path: "dropdown_options"
              label: "Dropdown"
              format: "markdown"
        - layout: "table"
          fields:
            - path: "emotion_options"
              label: "Emojis"
              format: "markdown"
  # Replicates /emotion <emotion>
  /emotion:
    operationId: "handle_emotion_selection_api_v1_chat_emotion_post"
    description: "Submit emotion selection"
    mapping:
      emotion: "$1"
    formatting:
      title: "ðŸ“– Message"
      blocks:
        - fields:
          - path: "messages[0].content"
            label: "Response"
            format: "markdown"
        - layout: "table"
          fields:
            - path: "dropdown_options"
              label: "Choice"
              format: "markdown"

  # Replicates /dropdown <selection>
  /dropdown:
    operationId: "handle_dropdown_selection_api_v1_chat_dropdown_post"
    description: "Submit dropdown selection"
    mapping:
      selection: "$1"
    formatting:
      title: "ðŸ“– Message"
      blocks:
        - fields:
          - path: "messages[0].content"
            label: "Response"
            format: "markdown"
        - layout: "table"
          fields:
            - path: "dropdown_options"
              label: "Dropdown"
              format: "markdown"
            - path: "emotions"
              label: "emotions"
              format: "markdown"
  # Replicates /upload <file>
  # /upload:
  #   operationId: "upload_files_api_v1_files_upload_post"
  #   description: "Upload files"
  #   mapping:
  #     files: "$1"

  # # Replicates /delete-summary <user_id>
  # /delete-summary:
  #   operationId: "delete_user_summary_api_v1_chat_delete_post"
  #   description: "Delete user summary"
  #   mapping:
  #     user_id: "$1"

# TUI customization for better visual representation
tui:
# aggregation_depth: 2 # Groups by /api/v1/
  type_icons:
    string: "ðŸ’¬"
    object: "ðŸ“¦"
    array: "ðŸ“‹"
